<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>3081WFlashphoto: Common Tasks</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">3081WFlashphoto
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Common Tasks </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>If you want to add a new filter to the program, you will first need to determine whether it is a filter in-place or a convolution filter. A filter in place means that it only need the ColorData of a single pixel, and it can only change the ColorData of this pixel. In this case, our Filter class already implements the ApplyToFilter() function, which applies the filter to the image, and return a new image. A convolution filter means a filter whose new color for a pixel depends not only upon the original color of that pixel but also upon the original colors of its neighbors. In this situation, the ConvolutionFilter class implements the ApplyToFilter() function. It saves a copy of the original colors before modifying the image. And it loops through the image to apply the filter. In both cases, you do not need to worry about how to apply the filter to the image.</p>
<ul>
<li>Here are the steps to add a in-place filter:</li>
</ul>
<ol type="1">
<li>Decide the algorithm you want to apply to a single pixel. You need to have a class, say FilterExample, which is a subclass of Filter. The codes for <code>filter_example.h</code> are like this: <pre class="fragment">#ifndef IMAGETOOLS_FILTER_EXAMPLE_H_
#define IMAGETOOLS_FILTER_EXAMPLE_H_

#include &lt;cmath&gt;
#include &lt;string&gt;
#include "imagetools/color_data.h"
#include "imagetools/filter.h"

namespace image_tools {

class FilterExample : public Filter {
 public:
  FilterExample();
  explicit FilterExample(...);
  virtual ~FilterExample();
  ... // declare the getter and setter functions of the class member variables,
  ... // override the CalculateFilteredPixel() function in the header file.

private:
  ... // class member variables
};

}

#endif
</pre></li>
<li>For the <code>filter_example.cc</code> file, what you need to do is to implement the getter and setter functions and also the <code>CalculateFilteredPixel()</code> function. In the <code>ColorData CalculateFilteredPixel(PixelBuffer *buffer, int x, int y)</code>, you can get the color of the pixel in the image of <code>buffer</code>, with the index of <code>(x, y)</code> using <code>ColorData color = buffer-&gt;pixel(x, y);</code>. And get get the RGB data by: <pre class="fragment">float red = color.red();
float green = color.green();
float blue = color.blue();
float alpha = color.alpha();
</pre></li>
</ol>
<p>Then you can manipulate with those values and get the new values for <code>red</code>, <code>green</code>, <code>blue</code> and <code>alpha</code>. Then return the new color by: </p><pre class="fragment">ColorData new_color = ColorData(new_red, new_green, new_blue);
return new_color;
</pre><p> or ColorData new_color = ColorData(new_red, new_green, new_alpha); return new_color;</p>
<ul>
<li>Here are the steps to add a convolution filter:</li>
</ul>
<ol type="1">
<li>Decide the algorithm you want to apply to a pixel. You need to have a class, say ConvolutionFilterExample, which is a subclass of ConvolutionFilter. The codes for <code>filter_convolution_example.h</code> are like this: <pre class="fragment">#ifndef IMAGETOOLS_FILTER_CONVOLUTION_EXAMPLE_H_
#define IMAGETOOLS_FILTER_CONVOLUTION_EXAMPLE_H_

#include &lt;cmath&gt;
#include &lt;string&gt;
#include "imagetools/filter.h"
#include "imagetools/filter_convolution.h"
#include "imagetools/color_data.h"
#include "imagetools/float_matrix.h"
#include "imagetools/pixel_buffer.h"

namespace image_tools {

class ConvolutionFilterExample : public ConvolutionFilter {
 public:
  ConvolutionFilterExample();
  explicit ConvolutionFilterExample(...);
  virtual ~ConvolutionFilterExample();

  ... // declare the getter and setter functions of the class member variables,
  ... // override the CreateKernel() function in the header file.

private:
  ... // class member variables
};

}

#endif
</pre></li>
<li>For the <code>filter_convolution_example.cc</code> file, what you need to do is to implement the getter and setter functions and also the <code>CreateKernel()</code> function. In the <code>FloatMatrix* CreateKernel()</code>, you can decide how you want to design the kernel. A kernel is a float matrix which will be applied to each pixels and its corresponding neighbors. For a kernel with size kernel_size, it is applied as this: <pre class="fragment">for (int filterY = 0; filterY &lt; kernel_size; filterY++) {
  for (int filterX = 0; filterX &lt; kernel_size; filterX++) {
    int pixelX = (x - kernel_size/ 2 + filterX + w) % w;
    int pixelY = (y - kernel_size/ 2 + filterY + h) % h;
    red += buffer-&gt;pixel(pixelX, pixelY).red() *
      kernel_-&gt;value(filterX, filterY);
    green += buffer-&gt;pixel(pixelX, pixelY).green() *
      kernel_-&gt;value(filterX, filterY);
    blue += buffer-&gt;pixel(pixelX, pixelY).blue() *
      kernel_-&gt;value(filterX, filterY);
  }
}
</pre></li>
</ol>
<p>The <code>red</code>, <code>green</code>, and <code>blue</code> are the corresponding values in the <code>ColorData</code>.</p>
<p>When you set the values of a kernel, you can use codes like this: </p><pre class="fragment">for (int j = 0; j &lt; kernel-&gt;height(); j++) {
  for (int i = 0; i &lt; kernel-&gt;width(); i++) {
    int x = i - kernel-&gt;width() / 2;
    int y = j - kernel-&gt;height() / 2;
    ... // get the value for index (i, j) in the matrix
    kernel-&gt;set_value(i, j, value);
  }
}
</pre><p>After all the operations, a kernel will return using: </p><pre class="fragment">return kernel;
</pre><ul>
<li>If you want to add the filer to the mia command line mode, you need to do the following:</li>
</ul>
<ol type="1">
<li>Create a filter command, say ExampleFilterCommand, which is a subclass of ImageEditorCommand. YOu should add the class declaration to the <code>mia/image_editor_commands.h</code> file, using this: <pre class="fragment">class BlurFilterCommand : public ImageEditorCommand {
 public:
  BlurFilterCommand(...);
  virtual ~BlurFilterCommand();
  std::string Name() override;
  ... // getter of class member variables
  void Execute() override;

 private:
  ... // class member variables
};
</pre></li>
<li>Implement the functions in the <code>mia/image_editor_commands.cc</code> file.</li>
<li>Add the necessary command syntax to the <code>usage</code>, and add a if statement like this to parse the mia command line: <pre class="fragment">else if (strcmp(argv[i], ...) == 0) {
      if ((i+1) &gt;= argc || ...) { throw -1; } // Check for the necessary values
      ... // Get the necessary values
      ExampleFilterCommand ... = new ChannelsFilterCommand(...);
      command_list_.push_back(...);
      num_command++;
      i += ...;
}
</pre></li>
</ol>
<ul>
<li>If you want to add the filer, say ExampleFilter, to one of the GUIs, say mia, you need to do the following:</li>
</ul>
<ol type="1">
<li>Add a <code>void ApplyExampleFilter(...);</code> declaration to the public area of <code>mia/mia_app.h</code> file.</li>
<li>Add a <code>FilterExample f_example_;</code> declaration and necessary class member variables to the private area of <code>mia/mia_app.h</code> file.</li>
<li>Initialize the class member variables you added in <code>MiaApp::MiaApp()</code> function of <code>mia/mia_app.cc</code> file.</li>
<li><p class="startli">Implement the <code>ApplyExampleFilter()</code> function in the <code>mia/mia_app.cc</code> file, using codes like this:</p>
<p class="startli">void MiaApp::ApplyExampleFilter(...) { image_editor_.ApplyExampleFilter(...); }</p>
</li>
</ol>
<p>Citation: CSCI 3081W iteration1 handout CSCI 3081W iteration2 handout </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
